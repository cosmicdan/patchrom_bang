*** ShutdownThread.smali	2014-10-11 10:21:18.788209669 +1100
--- ShutdownThread.smali	2014-10-11 10:18:17.344205733 +1100
***************
*** 71,77 ****
  
  .field private static mTvOut:Lcom/mediatek/common/tvout/ITVOUTNative;
  
! .field private static pd:Landroid/app/ProgressDialog;
  
  .field private static sConfirmDialog:Landroid/app/AlertDialog;
  
--- 72,80 ----
  
  .field private static mTvOut:Lcom/mediatek/common/tvout/ITVOUTNative;
  
! .field private static mWakeAlarmCheckBox:Landroid/widget/CheckBox;
! 
! .field private static pd:Landroid/app/Dialog;
  
  .field private static sConfirmDialog:Landroid/app/AlertDialog;
  
***************
*** 135,141 ****
  
      sput-object v1, Lcom/android/server/power/ShutdownThread;->sConfirmDialog:Landroid/app/AlertDialog;
  
!     sput-object v1, Lcom/android/server/power/ShutdownThread;->pd:Landroid/app/ProgressDialog;
  
      new-instance v0, Ljava/lang/Object;
  
--- 138,144 ----
  
      sput-object v1, Lcom/android/server/power/ShutdownThread;->sConfirmDialog:Landroid/app/AlertDialog;
  
!     sput-object v1, Lcom/android/server/power/ShutdownThread;->pd:Landroid/app/Dialog;
  
      new-instance v0, Ljava/lang/Object;
  
***************
*** 271,277 ****
      return-object p0
  .end method
  
! .method static synthetic access$300(Landroid/content/Context;)V
      .locals 0
      .parameter "x0"
  
--- 274,289 ----
      return-object p0
  .end method
  
! .method static synthetic _disableWakeAlarm()V
!     .locals 0
! 
!     .prologue
!     invoke-static {}, Lcom/android/server/power/ShutdownThread;->disableWakeAlarm()V
! 
!     return-void
! .end method
! 
! .method static synthetic access$500(Landroid/content/Context;)V
      .locals 0
      .parameter "x0"
  
***************
*** 518,523 ****
      const/4 v2, 0x1
  
      :cond_3
      sget-object v5, Lcom/android/server/power/ShutdownThread;->mEnableAnimatingSync:Ljava/lang/Object;
  
      monitor-enter v5
--- 530,542 ----
      const/4 v2, 0x1
  
      :cond_3
+     sget-boolean v4, Lmiui/os/Build;->IS_CM_CUSTOMIZATION:Z
+ 
+     if-eqz v4, :cond_miui_0
+ 
+     const/4 v2, 0x1
+ 
+     :cond_miui_0
      sget-object v5, Lcom/android/server/power/ShutdownThread;->mEnableAnimatingSync:Ljava/lang/Object;
  
      monitor-enter v5
***************
*** 799,805 ****
  
      sget-object v4, Lcom/android/server/power/ShutdownThread;->pd:Landroid/app/ProgressDialog;
  
!     invoke-virtual {v4}, Landroid/app/ProgressDialog;->show()V
      :try_end_8
      .catchall {:try_start_8 .. :try_end_8} :catchall_2
  
--- 818,826 ----
  
      sget-object v4, Lcom/android/server/power/ShutdownThread;->pd:Landroid/app/ProgressDialog;
  
!     #invoke-virtual {v4}, Landroid/app/ProgressDialog;->show()V
! 
!     invoke-static {p0}, Lcom/android/server/power/ShutdownThread$Injector;->createShutDownDialog(Landroid/content/Context;)V
      :try_end_8
      .catchall {:try_start_8 .. :try_end_8} :catchall_2
  
***************
*** 1347,1353 ****
  
      move-result-object v1
  
!     sget-object v2, Lcom/android/server/power/ShutdownThread;->pd:Landroid/app/ProgressDialog;
  
      invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;
  
--- 1396,1402 ----
  
      move-result-object v1
  
!     sget-object v2, Lcom/android/server/power/ShutdownThread;->pd:Landroid/app/Dialog;
  
      invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;
  
***************
*** 1359,1380 ****
  
      invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
  
!     sget-object v0, Lcom/android/server/power/ShutdownThread;->pd:Landroid/app/ProgressDialog;
  
      if-eqz v0, :cond_0
  
!     sget-object v0, Lcom/android/server/power/ShutdownThread;->pd:Landroid/app/ProgressDialog;
  
!     invoke-virtual {v0}, Landroid/app/ProgressDialog;->dismiss()V
  
      const/4 v0, 0x0
  
!     sput-object v0, Lcom/android/server/power/ShutdownThread;->pd:Landroid/app/ProgressDialog;
  
      :cond_0
      return-void
  .end method
  
  .method public static isPowerOffDialogShowing()Z
      .locals 1
  
--- 1408,1491 ----
  
      invoke-static {v0, v1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
  
!     sget-object v0, Lcom/android/server/power/ShutdownThread;->pd:Landroid/app/Dialog;
  
      if-eqz v0, :cond_0
  
!     sget-object v0, Lcom/android/server/power/ShutdownThread;->pd:Landroid/app/Dialog;
  
!     invoke-virtual {v0}, Landroid/app/Dialog;->dismiss()V
  
      const/4 v0, 0x0
  
!     sput-object v0, Lcom/android/server/power/ShutdownThread;->pd:Landroid/app/Dialog;
  
      :cond_0
      return-void
  .end method
  
+ .method static getIsStarted()Z
+     .locals 1
+ 
+     .prologue
+     sget-boolean v0, Lcom/android/server/power/ShutdownThread;->sIsStarted:Z
+ 
+     return v0
+ .end method
+ 
+ .method static getIsStartedGuard()Ljava/lang/Object;
+     .locals 1
+ 
+     .prologue
+     sget-object v0, Lcom/android/server/power/ShutdownThread;->sIsStartedGuard:Ljava/lang/Object;
+ 
+     return-object v0
+ .end method
+ 
+ .method static getReboot()Z
+     .locals 1
+ 
+     .prologue
+     sget-boolean v0, Lcom/android/server/power/ShutdownThread;->mReboot:Z
+ 
+     return v0
+ .end method
+ 
+ .method private static getResourceId(I)I
+     .locals 1
+     .parameter "id"
+ 
+     .prologue
+     sget-boolean v0, Lcom/android/server/power/ShutdownThread;->mReboot:Z
+ 
+     if-eqz v0, :cond_0
+ 
+     const p0, 0x60c019a
+ 
+     .end local p0
+     :cond_0
+     return p0
+ .end method
+ 
+ .method private static getTitleResourceId()I
+     .locals 1
+ 
+     .prologue
+     sget-boolean v0, Lcom/android/server/power/ShutdownThread;->mReboot:Z
+ 
+     if-eqz v0, :cond_0
+ 
+     const v0, 0x60c000d
+ 
+     :goto_0
+     return v0
+ 
+     :cond_0
+     const v0, 0x60c0026
+ 
+     goto :goto_0
+ .end method
+ 
  .method public static isPowerOffDialogShowing()Z
      .locals 1
  
***************
*** 1980,1989 ****
  
      move-result-object v3
  
-     invoke-virtual {v3, v2}, Landroid/app/AlertDialog$Builder;->setMessage(I)Landroid/app/AlertDialog$Builder;
- 
-     move-result-object v3
- 
      const v4, 0x1040013
  
      new-instance v5, Lcom/android/server/power/ShutdownThread$2;
--- 2170,2175 ----
  
      move-result-object v3
  
      const v4, 0x1040013
  
      new-instance v5, Lcom/android/server/power/ShutdownThread$2;
***************
*** 2010,2015 ****
  
      sput-object v3, Lcom/android/server/power/ShutdownThread;->sConfirmDialog:Landroid/app/AlertDialog;
  
      sget-boolean v3, Lcom/android/server/power/ShutdownThread;->mReboot:Z
  
      if-eqz v3, :cond_3
--- 2196,2209 ----
  
      sput-object v3, Lcom/android/server/power/ShutdownThread;->sConfirmDialog:Landroid/app/AlertDialog;
  
+     sget-object v3, Lcom/android/server/power/ShutdownThread;->sConfirmDialog:Landroid/app/AlertDialog;
+ 
+     invoke-static {v3}, Lcom/android/server/power/ShutdownThread;->showWakeAlarmInDialog(Landroid/app/AlertDialog;)V
+ 
+     sget-object v3, Lcom/android/server/power/ShutdownThread;->sConfirmDialog:Landroid/app/AlertDialog;
+ 
+     invoke-static {v3}, Lcom/android/server/power/ShutdownThread$Injector;->setDialogTitle(Landroid/app/Dialog;)V
+ 
      sget-boolean v3, Lcom/android/server/power/ShutdownThread;->mReboot:Z
  
      if-eqz v3, :cond_3
***************
*** 2939,2955 ****
  
      invoke-virtual {v2, v3}, Lcom/android/internal/app/ShutdownManager;->finishShutdown(Landroid/content/Context;)V
  
!     sget-object v2, Lcom/android/server/power/ShutdownThread;->pd:Landroid/app/ProgressDialog;
  
      if-eqz v2, :cond_11
  
!     sget-object v2, Lcom/android/server/power/ShutdownThread;->pd:Landroid/app/ProgressDialog;
  
!     invoke-virtual {v2}, Landroid/app/ProgressDialog;->dismiss()V
  
      const/4 v2, 0x0
  
!     sput-object v2, Lcom/android/server/power/ShutdownThread;->pd:Landroid/app/ProgressDialog;
  
      :cond_7
      :goto_a
--- 3135,3151 ----
  
      invoke-virtual {v2, v3}, Lcom/android/internal/app/ShutdownManager;->finishShutdown(Landroid/content/Context;)V
  
!     sget-object v2, Lcom/android/server/power/ShutdownThread;->pd:Landroid/app/Dialog;
  
      if-eqz v2, :cond_11
  
!     sget-object v2, Lcom/android/server/power/ShutdownThread;->pd:Landroid/app/Dialog;
  
!     invoke-virtual {v2}, Landroid/app/Dialog;->dismiss()V
  
      const/4 v2, 0x0
  
!     sput-object v2, Lcom/android/server/power/ShutdownThread;->pd:Landroid/app/Dialog;
  
      :cond_7
      :goto_a
