*** ./smali/android/net/wifi/WifiConfigStore.smali	2014-10-11 10:20:27.824208563 +1100
--- /home/cosmicdan/patchrom_mtk/bang/temp/new_smali/framework.jar.out/./smali/android/net/wifi/WifiConfigStore.smali	2014-10-11 10:17:23.076204556 +1100
***************
*** 413,418 ****
--- 413,419 ----
      invoke-direct {v0, v1}, Landroid/net/wifi/WifiConfigStore;->loge(Ljava/lang/String;)V
  
      :goto_0
+     :cond_miui_0
      if-eqz v19, :cond_1a
  
      if-eqz v16, :cond_1
***************
*** 1023,1028 ****
--- 1024,1035 ----
      goto/16 :goto_0
  
      :cond_a
+     invoke-direct/range {p0 .. p1}, Landroid/net/wifi/WifiConfigStore;->setExtraNetworkVariables(Landroid/net/wifi/WifiConfiguration;)Z
+ 
+     move-result v22
+ 
+     if-eqz v22, :cond_miui_0
+ 
      const/4 v11, 0x0
  
      .local v11, hasSetKey:Z
***************
*** 3573,3578 ****
--- 3580,3587 ----
      goto :goto_8
  
      :cond_9
+     invoke-direct {p0, p1}, Landroid/net/wifi/WifiConfigStore;->readExtraNetworkVariables(Landroid/net/wifi/WifiConfiguration;)V
+ 
      iget-object v10, p0, Landroid/net/wifi/WifiConfigStore;->mWifiNative:Landroid/net/wifi/WifiNative;
  
      const-string v11, "psk"
***************
*** 6774,6776 ****
--- 6783,7127 ----
          :pswitch_1
      .end packed-switch
  .end method
+ 
+ .method private readExtraNetworkVariables(Landroid/net/wifi/WifiConfiguration;)V
+     .locals 5
+     .parameter "config"
+ 
+     .prologue
+     const/4 v2, 0x0
+ 
+     iget v0, p1, Landroid/net/wifi/WifiConfiguration;->networkId:I
+ 
+     .local v0, netId:I
+     if-gez v0, :cond_0
+ 
+     :goto_0
+     return-void
+ 
+     :cond_0
+     iget-object v3, p0, Landroid/net/wifi/WifiConfigStore;->mWifiNative:Landroid/net/wifi/WifiNative;
+ 
+     const-string v4, "as_cert_file"
+ 
+     invoke-virtual {v3, v0, v4}, Landroid/net/wifi/WifiNative;->getNetworkVariable(ILjava/lang/String;)Ljava/lang/String;
+ 
+     move-result-object v1
+ 
+     .local v1, value:Ljava/lang/String;
+     invoke-static {v1}, Landroid/text/TextUtils;->isEmpty(Ljava/lang/CharSequence;)Z
+ 
+     move-result v3
+ 
+     if-nez v3, :cond_2
+ 
+     .end local v1           #value:Ljava/lang/String;
+     :goto_1
+     iput-object v1, p1, Landroid/net/wifi/WifiConfiguration;->wapiASCert:Ljava/lang/String;
+ 
+     iget-object v3, p0, Landroid/net/wifi/WifiConfigStore;->mWifiNative:Landroid/net/wifi/WifiNative;
+ 
+     const-string v4, "user_cert_file"
+ 
+     invoke-virtual {v3, v0, v4}, Landroid/net/wifi/WifiNative;->getNetworkVariable(ILjava/lang/String;)Ljava/lang/String;
+ 
+     move-result-object v1
+ 
+     .restart local v1       #value:Ljava/lang/String;
+     invoke-static {v1}, Landroid/text/TextUtils;->isEmpty(Ljava/lang/CharSequence;)Z
+ 
+     move-result v3
+ 
+     if-nez v3, :cond_3
+ 
+     .end local v1           #value:Ljava/lang/String;
+     :goto_2
+     iput-object v1, p1, Landroid/net/wifi/WifiConfiguration;->wapiUserCert:Ljava/lang/String;
+ 
+     iget-object v3, p0, Landroid/net/wifi/WifiConfigStore;->mWifiNative:Landroid/net/wifi/WifiNative;
+ 
+     const-string v4, "wapi_key_type"
+ 
+     invoke-virtual {v3, v0, v4}, Landroid/net/wifi/WifiNative;->getNetworkVariable(ILjava/lang/String;)Ljava/lang/String;
+ 
+     move-result-object v1
+ 
+     .restart local v1       #value:Ljava/lang/String;
+     invoke-static {v1}, Landroid/text/TextUtils;->isEmpty(Ljava/lang/CharSequence;)Z
+ 
+     move-result v3
+ 
+     if-nez v3, :cond_1
+ 
+     :try_start_0
+     invoke-static {v1}, Ljava/lang/Integer;->parseInt(Ljava/lang/String;)I
+ 
+     move-result v3
+ 
+     iput v3, p1, Landroid/net/wifi/WifiConfiguration;->wapiPskType:I
+     :try_end_0
+     .catch Ljava/lang/NumberFormatException; {:try_start_0 .. :try_end_0} :catch_0
+ 
+     :cond_1
+     :goto_3
+     iget-object v3, p0, Landroid/net/wifi/WifiConfigStore;->mWifiNative:Landroid/net/wifi/WifiNative;
+ 
+     const-string v4, "wapi_psk"
+ 
+     invoke-virtual {v3, v0, v4}, Landroid/net/wifi/WifiNative;->getNetworkVariable(ILjava/lang/String;)Ljava/lang/String;
+ 
+     move-result-object v1
+ 
+     invoke-static {v1}, Landroid/text/TextUtils;->isEmpty(Ljava/lang/CharSequence;)Z
+ 
+     move-result v3
+ 
+     if-nez v3, :cond_4
+ 
+     .end local v1           #value:Ljava/lang/String;
+     :goto_4
+     iput-object v1, p1, Landroid/net/wifi/WifiConfiguration;->wapiPsk:Ljava/lang/String;
+ 
+     goto :goto_0
+ 
+     .restart local v1       #value:Ljava/lang/String;
+     :cond_2
+     move-object v1, v2
+ 
+     goto :goto_1
+ 
+     :cond_3
+     move-object v1, v2
+ 
+     goto :goto_2
+ 
+     :cond_4
+     move-object v1, v2
+ 
+     goto :goto_4
+ 
+     :catch_0
+     move-exception v3
+ 
+     goto :goto_3
+ .end method
+ 
+ .method private setExtraNetworkVariables(Landroid/net/wifi/WifiConfiguration;)Z
+     .locals 5
+     .parameter "config"
+ 
+     .prologue
+     const/4 v1, 0x0
+ 
+     iget v0, p1, Landroid/net/wifi/WifiConfiguration;->networkId:I
+ 
+     .local v0, netId:I
+     iget-object v2, p1, Landroid/net/wifi/WifiConfiguration;->wapiASCert:Ljava/lang/String;
+ 
+     if-eqz v2, :cond_0
+ 
+     iget-object v2, p1, Landroid/net/wifi/WifiConfiguration;->wapiASCert:Ljava/lang/String;
+ 
+     const-string v3, "*"
+ 
+     invoke-virtual {v2, v3}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
+ 
+     move-result v2
+ 
+     if-nez v2, :cond_0
+ 
+     iget-object v2, p0, Landroid/net/wifi/WifiConfigStore;->mWifiNative:Landroid/net/wifi/WifiNative;
+ 
+     const-string v3, "as_cert_file"
+ 
+     iget-object v4, p1, Landroid/net/wifi/WifiConfiguration;->wapiASCert:Ljava/lang/String;
+ 
+     invoke-virtual {v2, v0, v3, v4}, Landroid/net/wifi/WifiNative;->setNetworkVariable(ILjava/lang/String;Ljava/lang/String;)Z
+ 
+     move-result v2
+ 
+     if-nez v2, :cond_0
+ 
+     new-instance v2, Ljava/lang/StringBuilder;
+ 
+     invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V
+ 
+     const-string v3, "- config.wapiASCert = "
+ 
+     invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+ 
+     move-result-object v2
+ 
+     iget-object v3, p1, Landroid/net/wifi/WifiConfiguration;->wapiASCert:Ljava/lang/String;
+ 
+     invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+ 
+     move-result-object v2
+ 
+     invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+ 
+     move-result-object v2
+ 
+     invoke-direct {p0, v2}, Landroid/net/wifi/WifiConfigStore;->loge(Ljava/lang/String;)V
+ 
+     :goto_0
+     return v1
+ 
+     :cond_0
+     iget-object v2, p1, Landroid/net/wifi/WifiConfiguration;->wapiUserCert:Ljava/lang/String;
+ 
+     if-eqz v2, :cond_1
+ 
+     iget-object v2, p1, Landroid/net/wifi/WifiConfiguration;->wapiUserCert:Ljava/lang/String;
+ 
+     const-string v3, "*"
+ 
+     invoke-virtual {v2, v3}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
+ 
+     move-result v2
+ 
+     if-nez v2, :cond_1
+ 
+     iget-object v2, p0, Landroid/net/wifi/WifiConfigStore;->mWifiNative:Landroid/net/wifi/WifiNative;
+ 
+     const-string v3, "user_cert_file"
+ 
+     iget-object v4, p1, Landroid/net/wifi/WifiConfiguration;->wapiUserCert:Ljava/lang/String;
+ 
+     invoke-virtual {v2, v0, v3, v4}, Landroid/net/wifi/WifiNative;->setNetworkVariable(ILjava/lang/String;Ljava/lang/String;)Z
+ 
+     move-result v2
+ 
+     if-nez v2, :cond_1
+ 
+     new-instance v2, Ljava/lang/StringBuilder;
+ 
+     invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V
+ 
+     const-string v3, "- config.wapiUserCert =  "
+ 
+     invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+ 
+     move-result-object v2
+ 
+     iget-object v3, p1, Landroid/net/wifi/WifiConfiguration;->wapiUserCert:Ljava/lang/String;
+ 
+     invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+ 
+     move-result-object v2
+ 
+     invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+ 
+     move-result-object v2
+ 
+     invoke-direct {p0, v2}, Landroid/net/wifi/WifiConfigStore;->loge(Ljava/lang/String;)V
+ 
+     goto :goto_0
+ 
+     :cond_1
+     iget-object v2, p1, Landroid/net/wifi/WifiConfiguration;->allowedKeyManagement:Ljava/util/BitSet;
+ 
+     const/4 v3, 0x5
+ 
+     invoke-virtual {v2, v3}, Ljava/util/BitSet;->get(I)Z
+ 
+     move-result v2
+ 
+     if-eqz v2, :cond_3
+ 
+     iget-object v2, p1, Landroid/net/wifi/WifiConfiguration;->wapiPsk:Ljava/lang/String;
+ 
+     if-eqz v2, :cond_2
+ 
+     iget-object v2, p1, Landroid/net/wifi/WifiConfiguration;->wapiPsk:Ljava/lang/String;
+ 
+     const-string v3, "*"
+ 
+     invoke-virtual {v2, v3}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
+ 
+     move-result v2
+ 
+     if-nez v2, :cond_2
+ 
+     iget-object v2, p0, Landroid/net/wifi/WifiConfigStore;->mWifiNative:Landroid/net/wifi/WifiNative;
+ 
+     const-string v3, "wapi_psk"
+ 
+     iget-object v4, p1, Landroid/net/wifi/WifiConfiguration;->wapiPsk:Ljava/lang/String;
+ 
+     invoke-virtual {v2, v0, v3, v4}, Landroid/net/wifi/WifiNative;->setNetworkVariable(ILjava/lang/String;Ljava/lang/String;)Z
+ 
+     move-result v2
+ 
+     if-nez v2, :cond_2
+ 
+     new-instance v2, Ljava/lang/StringBuilder;
+ 
+     invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V
+ 
+     const-string v3, "failed to set wapi psk: "
+ 
+     invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+ 
+     move-result-object v2
+ 
+     iget-object v3, p1, Landroid/net/wifi/WifiConfiguration;->wapiPsk:Ljava/lang/String;
+ 
+     invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+ 
+     move-result-object v2
+ 
+     invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+ 
+     move-result-object v2
+ 
+     invoke-direct {p0, v2}, Landroid/net/wifi/WifiConfigStore;->loge(Ljava/lang/String;)V
+ 
+     goto :goto_0
+ 
+     :cond_2
+     iget-object v2, p0, Landroid/net/wifi/WifiConfigStore;->mWifiNative:Landroid/net/wifi/WifiNative;
+ 
+     const-string v3, "wapi_key_type"
+ 
+     iget v4, p1, Landroid/net/wifi/WifiConfiguration;->wapiPskType:I
+ 
+     invoke-static {v4}, Ljava/lang/Integer;->toString(I)Ljava/lang/String;
+ 
+     move-result-object v4
+ 
+     invoke-virtual {v2, v0, v3, v4}, Landroid/net/wifi/WifiNative;->setNetworkVariable(ILjava/lang/String;Ljava/lang/String;)Z
+ 
+     move-result v2
+ 
+     if-nez v2, :cond_3
+ 
+     new-instance v2, Ljava/lang/StringBuilder;
+ 
+     invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V
+ 
+     const-string v3, "failed to set wapi key type: "
+ 
+     invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+ 
+     move-result-object v2
+ 
+     iget v3, p1, Landroid/net/wifi/WifiConfiguration;->wapiPskType:I
+ 
+     invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
+ 
+     move-result-object v2
+ 
+     invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+ 
+     move-result-object v2
+ 
+     invoke-direct {p0, v2}, Landroid/net/wifi/WifiConfigStore;->loge(Ljava/lang/String;)V
+ 
+     goto/16 :goto_0
+ 
+     :cond_3
+     const/4 v1, 0x1
+ 
+     goto/16 :goto_0
+ .end method
